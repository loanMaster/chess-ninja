import{d as T,r as u,aA as A,b0 as D,C as F,a as q,o as d,e as f,h as g,g as r,t as p,f as w,w as Q,Q as B,F as G,l as I,ai as U,ay as O,ar as z,j as E}from"./index.acb1a3f4.js";import{_ as W}from"./PieceList.a141debc.js";import{c as H,e as _,_ as J}from"./register-defaults.4e197f54.js";import{C as M}from"./chess-utils.5eb9ca53.js";import{u as v}from"./exercise.store.a03c0b34.js";import"./chess-board.interface.005362a6.js";import"./dateTimestampProvider.aca62768.js";const X={key:0,class:"flex-1 justify-center column items-center"},Y={class:"text-h5 text-center"},Z={class:"g-large-font g-full-width q-mt-md"},ee={class:"row q-gutter-md max-width-xs q-mt-md justify-center"},te={class:"flex-1",style:{"max-height":"100%"}},se={class:"column items-center"},ve=T({__name:"SaveTheKingView",setup(ae){const{revealed:c,store:P,inputDisabled:l}=H(),h=u(!1),S=z(),a=u(""),C=u("w"),i=new A,m=u("k"),n=u(""),y=["Q","B","N","R"],x=u(!1);D(()=>{_.createExercise(10)}),F(async()=>{l.value=!0,v().beginExercise(),N()});async function N(){if(!await _.prepareNewQuestion({inputDisabled:l,revealed:c,router:S}))return;m.value=y[v().exercise.currentQuestion%y.length],n.value=M.getOtherRandomSquare([n.value]),i.createNew({pieces:{[n.value]:m.value}});const e=i.moves(n.value).map(t=>t.to);x.value=Math.random()>.5;do a.value=M.getOtherRandomSquare([n.value]);while(e.indexOf(a.value)>-1!==x.value);v().$patch(t=>{t.board={...t.board,orientation:"white",pieces:{[a.value.toLowerCase()]:`${C.value}K`,[n.value.toLowerCase()]:`${C.value==="w"?"b":"w"}${m.value}`},highlightPositive:[],highlightNegative:[]}}),l.value=!1}const V=q(()=>v().board.pieces);function b(e,t){if(l.value)return;t.stopPropagation(),i.createNew({pieces:{[n.value]:m.value}});const o=i.moves(n.value).map(s=>s.to);i.createNew({pieces:{[a.value]:"K"}});const k=i.moves(a.value).map(s=>s.to),$=x.value?k.filter(s=>o.indexOf(s)===-1):[a.value];h.value=$.indexOf(e)>-1,h.value?(l.value=!0,P.$patch(s=>s.exercise.correctAnswers++),v().$patch(s=>{s.board.highlightPositive=[e],s.board.highlightNegative=[]})):(_.handleMistake(K,void 0),v().$patch(s=>{s.board.highlightPositive=$,s.board.highlightNegative=[e]})),c.value=!0}function K(){c.value=!0,l.value=!0}function R(e){c.value&&(e.stopPropagation(),N())}function j(e){b(a.value,e)}const L=q(()=>{if(a.value){i.createNew({pieces:{[a.value]:"K"}});const e=i.moves(a.value).map(t=>t.to);return e.sort((t,o)=>t>o?1:-1),e}else return[]});return(e,t)=>(d(),f("div",{class:"relative-position column flex-1 self-stretch",onClick:R,ref:"coreExercise"},[g(c)?U("",!0):(d(),f("div",X,[r("div",Y,p(e.$t("Is your king under attack? Bring him to safety otherwise click on 'Not in check'")),1),r("div",Z,[w(W,{pieces:g(V)},null,8,["pieces"])]),w(B,{push:"",color:"primary",onClick:t[0]||(t[0]=o=>j(o)),class:"q-mt-md","no-caps":""},{default:Q(()=>[E(p(e.$t("Not in check")),1)]),_:1}),r("div",ee,[(d(!0),f(G,null,I(g(L),o=>(d(),f("div",{key:o,class:"text-h5"},[w(B,{push:"",color:"primary",onClick:k=>b(o,k),"no-caps":""},{default:Q(()=>[E(p(o),1)]),_:2},1032,["onClick"])]))),128))])])),r("div",{style:O({opacity:g(c)?1:0}),class:"no-pointer-events absolute-full column items-stretch q-pa-lg"},[r("div",{class:"text-h5 text-center",style:O({color:h.value?"green":"red"})},p(h.value?e.$t("Correct"):e.$t("Wrong")),5),r("div",te,[w(J)]),r("div",se,[r("span",null,p(e.$t("Click to continue")),1)])],4)],512))}});export{ve as default};
