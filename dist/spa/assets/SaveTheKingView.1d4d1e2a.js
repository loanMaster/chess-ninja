import{d as T,r as u,aA as A,b1 as D,C as F,a as q,o as d,e as f,h as g,g as i,t as p,f as w,w as Q,Q as B,F as G,l as I,ao as U,av as O,an as z,j as E}from"./index.6125b9e8.js";import{_ as W}from"./PieceList.01dd5800.js";import{_ as H}from"./ExerciseBoard.a00eecf8.js";import{c as J,e as k}from"./register-defaults.25e039f8.js";import{C as M}from"./chess-utils.8ae7a03f.js";import{u as v}from"./exercise.store.1a84692e.js";import"./chess-board.interface.3e36622b.js";import"./dateTimestampProvider.aca62768.js";const X={key:0,class:"flex-1 justify-center column items-center"},Y={class:"text-h5 text-center"},Z={class:"g-large-font g-full-width q-mt-md"},ee={class:"text-h5 q-gutter-lg row"},te={class:"row q-gutter-md max-width-xs q-mt-md justify-center"},se={class:"flex-1",style:{"max-height":"100%"}},ae={class:"column items-center"},he=T({__name:"SaveTheKingView",setup(oe){const{revealed:c,store:P,inputDisabled:l}=J(),h=u(!1),S=z(),a=u(""),C=u("w"),n=new A,m=u("k"),r=u(""),y=["Q","B","N","R"],x=u(!1);D(()=>{k.createExercise(10)}),F(async()=>{l.value=!0,v().beginExercise(),N()});async function N(){if(!await k.prepareNewQuestion({inputDisabled:l,revealed:c,router:S}))return;m.value=y[v().exercise.currentQuestion%y.length],r.value=M.getOtherRandomSquare([r.value]),n.createNew({pieces:{[r.value]:m.value}});const e=n.moves(r.value).map(t=>t.to);x.value=Math.random()>.5;do a.value=M.getOtherRandomSquare([r.value]);while(e.indexOf(a.value)>-1!==x.value);v().$patch(t=>{t.board={...t.board,orientation:"white",pieces:{[a.value.toLowerCase()]:`${C.value}K`,[r.value.toLowerCase()]:`${C.value==="w"?"b":"w"}${m.value}`},highlightPositive:[],highlightNegative:[]}}),l.value=!1}const V=q(()=>v().board.pieces);function b(e,t){if(l.value)return;t.stopPropagation(),n.createNew({pieces:{[r.value]:m.value}});const o=n.moves(r.value).map(s=>s.to);n.createNew({pieces:{[a.value]:"K"}});const _=n.moves(a.value).map(s=>s.to),$=x.value?_.filter(s=>o.indexOf(s)===-1):[a.value];h.value=$.indexOf(e)>-1,h.value?(l.value=!0,P.$patch(s=>s.exercise.correctAnswers++),v().$patch(s=>{s.board.highlightPositive=[e],s.board.highlightNegative=[]})):(k.handleMistake(K,void 0),v().$patch(s=>{s.board.highlightPositive=$,s.board.highlightNegative=[e]})),c.value=!0}function K(){c.value=!0,l.value=!0}function R(e){c.value&&(e.stopPropagation(),N())}function j(e){b(a.value,e)}const L=q(()=>{if(a.value){n.createNew({pieces:{[a.value]:"K"}});const e=n.moves(a.value).map(t=>t.to);return e.sort((t,o)=>t>o?1:-1),e}else return[]});return(e,t)=>(d(),f("div",{class:"relative-position column flex-1 self-stretch",onClick:R,ref:"coreExercise"},[g(c)?U("",!0):(d(),f("div",X,[i("div",Y,p(e.$t("Is your king under attack? Bring him to safety otherwise click on 'Not in check'")),1),i("div",Z,[i("div",ee,[w(W,{pieces:g(V)},null,8,["pieces"])])]),w(B,{push:"",color:"primary",onClick:t[0]||(t[0]=o=>j(o)),class:"q-mt-md","no-caps":""},{default:Q(()=>[E(p(e.$t("Not in check")),1)]),_:1}),i("div",te,[(d(!0),f(G,null,I(g(L),o=>(d(),f("div",{key:o,class:"text-h5"},[w(B,{push:"",color:"primary",onClick:_=>b(o,_),"no-caps":""},{default:Q(()=>[E(p(o),1)]),_:2},1032,["onClick"])]))),128))])])),i("div",{style:O({opacity:g(c)?1:0}),class:"no-pointer-events absolute-full column items-stretch q-pa-lg"},[i("div",{class:"text-h5 text-center",style:O({color:h.value?"green":"red"})},p(h.value?e.$t("Correct"):e.$t("Wrong")),5),i("div",se,[w(H)]),i("div",ae,[i("span",null,p(e.$t("Click to continue")),1)])],4)],512))}});export{he as default};
